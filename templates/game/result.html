{% extends 'game_base.html' %}

<!-- ナビゲーションバーここから -->
{% block navbar %}
<li><a href="{{url_for('game.search')}}">SEARCH</a></li>
<li><a href="{{url_for('game.index', query=game.query, page=request.args.get('page', 1))}}">GAME LIST</a>
    {% endblock %}
    <!-- ナビゲーションバーここまで -->

    {% block content %}
    {% if game!=[] %}
    <h2 class="game-title">{{game.name}}</h2>
    <div class="wrapper">
        <aside>
            <div class="head-img">
                <img src="{{game.header}}" alt="ヘッダー画像">
            </div>
            <div class="short-desc">
                <p>{{game.short_description}}</p>
            </div>
        </aside>
        <main>
            <section>
                {% if game.videos!=[] or game.screenshots!=[]%}
                <div class="media-main">
                    {% if game.videos!=[] %}
                    <div id="mediaLoading" class="media-loading" style="display: none;">
                        <div class="spinner"></div>
                    </div>
                    <div class="video custom-video-player">
                        <video id="mainVideo" src="{{game.videos[0]['480p']}}" poster="{{game.thumbnails[0]}}"
                            type="video/webm"></video>
                        <div class="controls">
                            <div class="time-bar-area">
                                <input type="range" id="timeBar" class="time-bar" min="0" max="100" value="0"
                                    step="0.1">
                                <div id="timeIndicator" class="time-indicator" style="display: none;"></div>
                            </div>
                            <div class="button-area">
                                <div class="former">
                                    <button class="seek-btn" id="backwardBtn" title="10秒戻す (j)"><i
                                            class="fa-solid fa-backward-fast"></i></button>
                                    <button class="play-btn" id="playPauseBtn" title="再生 (k)"><i
                                            class="fa-solid fa-play"></i></button>
                                    <button class="seek-btn" id="forwardBtn" title="10秒進める (l)"><i
                                            class="fa-solid fa-forward-fast"></i></button>
                                    <div class="time-txt">
                                        <span id="currentTime">0:00</span><span id="separator"> / </span><span
                                            id="duration">0:00</span>
                                    </div>
                                </div>
                                <div class="latter">
                                    <div class="volume-control">
                                        <button id="volumeIcon" class="volume-icon" title="音量 (m)">
                                            <span id="volumeIconSymbol"><i class="fa-solid fa-volume-high"></i></span>
                                            <!-- スピーカー -->
                                        </button>
                                        <input type="range" id="volumeBar" min="0" max="1" step="0.01" value="1"
                                            class="volume-bar">
                                    </div>
                                    <div class="settings-control">
                                        <button id="settingsBtn" class="settings-btn" title="画質設定">
                                            <i class="fa-solid fa-gear" style="font-size: 1.125rem;"></i>
                                        </button>
                                        <div id="qualityMenu" class="quality-menu" style="display: none;">
                                            <ul>
                                                <li data-quality="480p" class="selected">480p (SD)</li>
                                                <li data-quality="1080p">1080p (HD)</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <button class="fullscreen-btn" id="fullscreenBtn" title="全画面 (f)"><i
                                            class="fa-solid fa-expand"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="image hidden">
                        <img src="" alt="スクリーンショット">
                    </div>
                    {% elif game.screenshots!=[] %}
                    <div class="video hidden">
                        <video src="" poster="" type="video/webm" controls allowfullscreen></video>
                    </div>
                    <div class="image">
                        <img src="{{game.screenshots[0]['1080p']}}" alt="スクリーンショット">
                    </div>
                    {% else %}
                    <div class="video hidden">
                        <video src="" poster="" type="video/webm" controls allowfullscreen></video>
                    </div>
                    <div class="image hidden">
                        <img src="" alt="スクリーンショット">
                    </div>
                    {% endif %}
                </div>
                <div class="media-sub" data-simplebar data-simplebar-auto-hide="false">
                    <div class="slide-area"></div>
                </div>
                {% endif %}
            </section>
            <section>
                <div class="about-game">
                    <h2>ゲームについて</h2>
                    {% if game.about_the_game!="": %}
                    <div class="ag-box">
                        <input type="checkbox" id="ag-check">
                        <label for="ag-check"></label>
                        <div class="description"></div>
                    </div>
                    {% endif %}
                </div>
            </section>
        </main>
    </div>
    {% if game.review_exp %}
    <article class="review-info">
        <h2>一致した観点のユーザレビュー</h2>
        {% for review_id, obj in game.review_exp.items() %}
        <div class="review-panel" data-review-id="{{ review_id }}">
            <div class="review-text">
                <p></p>
            </div>
            <div class="vp-info">
                <div class="sim-group">
                    <strong>観点タイプ：</strong><span></span>
                </div>
                <div class="vp-name">
                    <strong>観点名：</strong><span></span>
                </div>
                <div class="eval-sentence">
                    <strong>つまり...：</strong><span></span>
                </div>
            </div>
        </div>
        {% endfor %}
    </article>
    {% endif %}
    {% else %}
    <h2 class="game-title">ゲーム情報がありません</h2>
    {% endif %}
    <!-- モーダルウィンドウ -->
    <div class="modal fade" id="screenshotModal" tabindex="-1" aria-labelledby="screenshotModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="screenshotModalLabel">スクリーンショット</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <img id="modalImage" src="" class="img-thumbnail">
                    <div class="move-btn">
                        <button id="prevButton" class="btn btn-secondary">前に戻る</button>
                        <div class="page-num"></div>
                        <button id="nextButton" class="btn btn-secondary">次に進む</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}

    {% block script %}
    <!-- 自作JS -->
    <script>
        'use strict';
        const game_info = {{ game | tojson | safe }};
    </script>
    <script src="{{url_for('static',filename='scripts/variables.js')}}"></script>
    <script src="{{url_for('static',filename='scripts/media.js')}}"></script>
    <script src="{{url_for('static',filename='scripts/modal_window.js')}}"></script>
    {% if game.videos!=[] %}
    <script src="{{url_for('static',filename='scripts/video_player/base.js')}}"></script>
    <script src="{{url_for('static',filename='scripts/video_player/definition_setting.js')}}"></script>
    <script src="{{url_for('static',filename='scripts/video_player/time_control.js')}}"></script>
    <script src="{{url_for('static',filename='scripts/video_player/fullscreen.js')}}"></script>
    <script src="{{url_for('static',filename='scripts/video_player/volume_control.js')}}"></script>
    {% endif %}
    <script src="{{url_for('static',filename='scripts/link_review.js')}}"></script>
    {% endblock %}